"use strict";(this.webpackChunkdiscord_app=this.webpackChunkdiscord_app||[]).push([[81094],{511217:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0});r.createSubscriptionInvoicePreview=S;r.getItemUnitPriceWithDiscount=function(e){var r=e.subscriptionPlanPrice;e.discounts.forEach((function(t){var n=t.amount/e.quantity;r-=n}));return r};r.getSubscriptionInvoice=_;r.updateSubscriptionInvoicePreview=P;r.useGetSubscriptionInvoice=function(e){var r=(0,n.useCallback)((function(){return _(e)}),[JSON.stringify(e)]);return x(e,r)};r.useSubscriptionInvoicePreview=function(e){if("subscriptionId"in e&&null==e.subscriptionId){var r=e,t=(r.subscriptionId,m(r,f));e=t}var u=(0,n.useCallback)((function(){return"subscriptionId"in e?P(e):"items"in e?S(e):null}),[JSON.stringify(e)]);return x(e,u)};var n=t(667294),u=t(536211),i=y(t(118915)),o=t(327269),a=y(t(412652)),c=y(t(146771)),s=t(838583),l=t(770348),f=["subscriptionId"],p=["planId"],d=["planId"];function y(e){return e&&e.__esModule?e:{
default:e}}function v(){v=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e};return v.apply(this,arguments)}function m(e,r){if(null==e)return{};var t,n,u={},i=Object.keys(e);for(n=0;n<i.length;n++){t=i[n];r.indexOf(t)>=0||(u[t]=e[t])}return u}function h(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==t)return;var n,u,i=[],o=!0,a=!1;try{for(t=t.call(e);!(o=(n=t.next()).done);o=!0){i.push(n.value);if(r&&i.length===r)break}}catch(e){a=!0;u=e}finally{try{o||null==t.return||t.return()}finally{if(a)throw u}}return i}(e,r)||function(e,r){if(!e)return;if("string"==typeof e)return b(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e)
;if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return b(e,r)}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function I(e,r,t,n,u,i,o){try{var a=e[i](o),c=a.value}catch(e){t(e);return}a.done?r(c):Promise.resolve(c).then(n,u)}function g(e){return function(){var r=this,t=arguments;return new Promise((function(n,u){var i=e.apply(r,t);function o(e){I(i,n,u,o,a,"next",e)}function a(e){I(i,n,u,o,a,"throw",e)}o(void 0)}))}}function S(e){return w.apply(this,arguments)}function w(){return(w=g(regeneratorRuntime.mark((function e(r){var t,n,u,c,f,d,y,h,b;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=r.items,n=r.paymentSourceId,u=r.trialId,c=r.code,f=r.applyEntitlements,d=void 0!==f&&f,y=r.currency
;t=(0,s.coerceExistingItemsToNewItemInterval)(t);h={items:t.map((function(e){var r=e.planId;return v({},m(e,p),{plan_id:r})})),payment_source_id:n,trial_id:u,code:c,apply_entitlements:d,currency:y};e.prev=3;e.next=6;return i.default.post({url:l.Endpoints.BILLING_SUBSCRIPTIONS_PREVIEW,body:h,oldFormErrors:!0});case 6:b=e.sent;return e.abrupt("return",a.default.createInvoiceFromServer(b.body));case 10:e.prev=10;e.t0=e.catch(3);throw new o.BillingError(e.t0);case 13:case"end":return e.stop()}}),e,null,[[3,10]])})))).apply(this,arguments)}function P(e){return O.apply(this,arguments)}function O(){return(O=g(regeneratorRuntime.mark((function e(r){var t,n,u,c,f,p,y,h,b,I;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r.subscriptionId,u=r.items,c=r.paymentSourceId,f=r.renewal,p=r.currency,y=r.applyEntitlements,h=void 0!==y&&y;null!=u&&(u=(0,s.coerceExistingItemsToNewItemInterval)(u));b={items:null===(t=u)||void 0===t?void 0:t.map((function(e){var r=e.planId
;return v({},m(e,d),{plan_id:r})})),payment_source_id:c,renewal:f,apply_entitlements:h,currency:p};e.prev=3;e.next=6;return i.default.patch({url:l.Endpoints.BILLING_SUBSCRIPTION_PREVIEW(n),body:b,oldFormErrors:!0});case 6:I=e.sent;return e.abrupt("return",a.default.createInvoiceFromServer(I.body));case 10:e.prev=10;e.t0=e.catch(3);throw new o.BillingError(e.t0);case 13:case"end":return e.stop()}}),e,null,[[3,10]])})))).apply(this,arguments)}function _(e){return E.apply(this,arguments)}function E(){return(E=g(regeneratorRuntime.mark((function e(r){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=r.subscriptionId;if(!r.preventFetch){e.next=3;break}return e.abrupt("return",null);case 3:e.next=5;return i.default.get({url:l.Endpoints.BILLING_SUBSCRIPTION_INVOICE(t),oldFormErrors:!0});case 5:n=e.sent;return e.abrupt("return",a.default.createInvoiceFromServer(n.body));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e,r){
var t=e.preventFetch,i=void 0!==t&&t,o=h((0,n.useState)(null),2),a=o[0],s=o[1],l=h((0,n.useState)(null),2),f=l[0],p=l[1],d=(0,u.useStateFromStores)([c.default],(function(){return c.default.getSubscriptions()}));(0,n.useEffect)((function(){var e=!1;function t(){return(t=g(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0;s(null);t.next=4;return r();case 4:n=t.sent;e||s(n);t.next=11;break;case 8:t.prev=8;t.t0=t.catch(0);e||p(t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))).apply(this,arguments)}i||function(){t.apply(this,arguments)}();return function(){e=!0}}),[i,r,d]);return[a,f]}},298104:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0});r.fetchSubscriptionPlansOnNewPaymentSource=h;r.getCurrencies=b;r.planHasCurrency=function(e,r,t){var n=c.default.get(e);(0,u.default)(null!=n,"plan is undefined");return b(n,t,!1).includes(r)}
;r.useCurrencyWithPaymentSourceChange=function(e,r,t,u,i){var o=(p=n.useReducer((function(e,r){return d({},e,{},r)}),null!=t?{paymentSourceId:t,currency:e}:{currency:e}),v=2,function(e){if(Array.isArray(e))return e}(p)||function(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var n,u,i=[],o=!0,a=!1;try{for(t=t.call(e);!(o=(n=t.next()).done);o=!0){i.push(n.value);if(r&&i.length===r)break}}catch(e){a=!0;u=e}finally{try{o||null==t.return||t.return()}finally{if(a)throw u}}return i}}(p,v)||function(e,r){if(e){if("string"==typeof e)return y(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);return"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?y(e,r):void 0}}(p,v)||function(){
throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),s=o[0],l=o[1],f=(0,a.useSubscriptionPlansLoaded)(i);var p,v;n.useEffect((function(){var e=function(){var e=m(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return h(t,i);case 2:n=[];null!=r&&null!=c.default.get(r)&&(n=b(r,t,u));n.length>0?l({paymentSourceId:t,currency:n[0]}):l({paymentSourceId:t});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[t,JSON.stringify(i),r,u,f]);var I=s.paymentSourceId!==t||null==r||!f;return{priceOptions:s,setCurrency:function(e){l({currency:e})},currencyLoading:I}};var n=function(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=p(r);if(t&&t.has(e))return t.get(e)
;var n={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var o=u?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}n.default=e;t&&t.set(e,n);return n}(t(667294)),u=f(t(441143)),i=f(t(636602)),o=t(856259),a=t(158384),c=f(t(909584)),s=t(838583),l=t(770348);function f(e){return e&&e.__esModule?e:{default:e}}function p(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(p=function(e){return e?t:r})(e)}function d(){d=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e};return d.apply(this,arguments)}function y(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function v(e,r,t,n,u,i,o){try{var a=e[i](o),c=a.value}catch(e){t(e);return}a.done?r(c):Promise.resolve(c).then(n,u)}
function m(e){return function(){var r=this,t=arguments;return new Promise((function(n,u){var i=e.apply(r,t);function o(e){v(i,n,u,o,a,"next",e)}function a(e){v(i,n,u,o,a,"throw",e)}o(void 0)}))}}function h(e,r){void 0===r&&(r=Object.values(l.PremiumSubscriptionSKUs));return null==e||c.default.hasPaymentSourceForSKUIds(e,r)?Promise.resolve():new Promise((function(e){i.default.wait(m(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return(0,o.fetchSubscriptionPlansBySKUs)(r);case 2:e();case 3:case"end":return t.stop()}}),t)}))))}))}function b(e,r,t){var n=[],i={purchaseType:t?l.PriceSetAssignmentPurchaseTypes.GIFT:l.PriceSetAssignmentPurchaseTypes.DEFAULT},o="string"==typeof e?e:e.id;if((0,s.inPriceDeterminationExperiment)()){var a=c.default.get(o);(0,u.default)(a,"subscription plan not loaded");null!=r&&c.default.hasPaymentSourceForSKUId(r,a.skuId)&&(i.paymentSourceId=r);if((n=(0,
s.experimentalGetPrices)(o,i).map((function(e){return e.currency}))).length<1)throw Error("No currencies returned for plan "+o+" and paymentSource "+r)}else n.push((0,s.getPrice)(o,!1,t,{paymentSourceId:r}).currency);return n}}}]);
//# sourceMappingURL=25aea78bc075430fac48.js.map